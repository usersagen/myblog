<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %}-知了博客</title>
    <link rel="stylesheet" href="{% static 'bootstrap5/bootstrap.min.css' %}">
    <script src="{% static 'bootstrap5/popper.min.js' %}"></script>
    <script src="{% static 'bootstrap5/bootstrap.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <style>
        .message-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
            word-wrap: break-word;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .close-btn {
            float: right;
            cursor: pointer;
            font-size: 20px;
            margin-left: 15px;
            line-height: 1;
        }

        /* 成功样式 */
        .message-popup.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        /* 失败样式 */
        .message-popup.error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
    </style>
    {% block head %}{% endblock %}


</head>

<body>
    <script>
        // 通用弹窗显示函数（供所有子页面调用）
        function showPopup(message, type = 'error') {
            // 防止重复创建相同弹窗
            const existingPopups = document.querySelectorAll('.message-popup');
            if (existingPopups.length > 0) {
                existingPopups.forEach(popup => popup.remove());
            }

            // 创建弹窗元素
            const popup = document.createElement('div');
            popup.className = `message-popup ${type}`; // 通过类名控制样式，更易维护

            // 弹窗内容（关闭按钮 + 消息）
            popup.innerHTML = `
                <span class="close-btn" onclick="this.parentElement.remove()">&times;</span>
                <span>${message}</span>
            `;

            // 添加到页面
            document.body.appendChild(popup);

            // 3秒后自动关闭
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 3000);
        }
    </script>
    <header class="p-3 text-bg-light border-bottom mb-3">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                    <img src="{% static 'image/logo.svg' %}" alt="" height="40">
                </a>

                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="/" class="nav-link px-2 text-secondary">首页</a></li>
                    <li><a href="{% url 'blog:pub_blog' %}" class="nav-link px-2 text-secondary">发布博客</a></li>
                </ul>

                <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search" action="{% url 'blog:search' %}"
                    method="GET">
                    <input type="search" name="q" class="form-control" placeholder="搜索..." aria-label="Search">
                </form>

                {% if user.is_authenticated %}
                <div class="dropdown text-end">
                    <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{% static 'image/head_portrait.svg' %}" alt="mdo" width="32" height="32"
                            class="rounded-circle">
                    </a>
                    <ul class="dropdown-menu text-small" style="">
                        <li><a class="dropdown-item" href="{% url 'user:logout' %}">退出登录</a></li>
                    </ul>
                </div>
                {% else %}
                <div class="text-end">
                    <a href="{% url 'user:login' %}" type="button" class="btn btn-outline-primary me-2">登录</a>
                    <a href="{% url 'user:register' %}" type="button" class="btn btn-primary">注册</a>
                </div>
                {% endif %}
            </div>
        </div>
    </header>
    <main class="container bg-white p-3 rounded">
        {% block main %}{% endblock %}
    </main>
        <script>
        // 全局消息处理（可选：统一处理Django messages）
        {% if messages %}
            {% for message in messages %}
                showPopup("{{ message|escapejs }}", "{{ message.tags }}");
            {% endfor %}
        {% endif %}
    </script>
</body>

</html>